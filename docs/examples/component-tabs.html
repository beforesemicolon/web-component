<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Component Instance</title>
	<script src="https://unpkg.com/@beforesemicolon/web-component/dist/web-component.min.js"
	        type="text/javascript"></script>
	<style id="app-css"></style>
</head>
<body>

<main id="app-html">

<tabs-container>
	<tab-head id="tab-img1" content-id="img1" active="true">Image 1</tab-head>
	<tab-content id="img1" tab-id="tab-img1">
		<img src="https://wallpaperaccess.com/full/1406844.png" alt="" width="100%">
	</tab-content>
	<tab-head id="tab-img2" content-id="img2">Image 2</tab-head>
	<tab-content id="img2" tab-id="tab-img2">
		<img src="https://wallpaperaccess.com/full/1406842.jpg" alt="" width="100%">
	</tab-content>
	<tab-head id="tab-img3" content-id="img3">Image 3</tab-head>
	<tab-content id="img3" tab-id="tab-img3">
		<img src="https://c4.wallpaperflare.com/wallpaper/58/483/756/digital-digital-art-artwork-illustration-romain-trystram-hd-wallpaper-preview.jpg" alt="" width="100%">
	</tab-content>
</tabs-container>

</main>

<script id="app-js">
class TabsContainer extends WebComponent {
	currentTabInfo = {
		node: null,
		index: 0,
		width: 0,
		left: 0,
	}
	
	onMount() {
		const {headContainer, contentContainer} = this.$refs;
		
		let index = 0;
		for (let el of Array.from(this.children)) {
			if (el.nodeName.toLowerCase() === 'tab-head') {
				headContainer.appendChild(el);
				
				if (el.getAttribute('active') === 'true') {
					this.currentTabInfo = {
						node: el,
						index: index,
						width: el.offsetWidth + 'px',
						left: el.offsetLeft + 'px',
					}
				}
				
				el.dataset.index = index;
				el.addEventListener('click', () => this.activateTab(el));
				
				index += 1;
			} else if (el.nodeName.toLowerCase() === 'tab-content') {
				contentContainer.appendChild(el);
				el.setAttribute('active', 'false');
			}
		}
		
		if (!this.currentTabInfo.node) {
			this.activateTab(headContainer.children[1])
		}
		
		this.root.getElementById(this.currentTabInfo.node.contentId).setAttribute('active', 'true');
	}
	
	activateTab(el) {
		this.currentTabInfo.node?.setAttribute('active', 'false');
		this.root.getElementById(this.currentTabInfo.node.contentId).setAttribute('active', 'false');
		el.setAttribute('active', 'true');
		this.currentTabInfo = {
			node: el,
			index: Number(el.dataset.index),
			width: el.offsetWidth + 'px',
			left: el.offsetLeft + 'px',
		}
		this.root.getElementById(el.contentId).setAttribute('active', 'true');
	}
	
	get stylesheet() {
		return `
			<style>
				:host {
					display: block;
				}
				
				:host * {
					box-sizing: border-box;
				}
				
				:host .tabs-header {
					position: relative;
					display: flex;
					gap: 5px;
					border-bottom: 1px solid #e5e5e5;
				}
				
				:host .current-tab-indicator {
					display: inline-block;
					height: 2px;
					width: [currentTabInfo.width];
					background: #222;
					position: absolute;
					bottom: 0;
					left: [currentTabInfo.left];
					transition: left 0.3s ease, width 0.3s ease;
				}
			</style>
		`;
	}
	
	get template() {
		return `
			<div class="tabs-header" ref="headContainer" role="tablist">
				<span class="current-tab-indicator"></span>
			</div>
			<div class="tabs-content-container" ref="contentContainer"></div>
		`;
	}
}

class TabHead extends WebComponent {
	static observedAttributes = [
		'active',
		'id',
		'content-id'
	];
	
	get stylesheet() {
		return `
			<style>
				:host {
					display: inline-block;
				}
				
				:host .tab-head {
					padding: 5px 18px;
					background: #e8e8e8;
					color: #666;
					border-top-left-radius: 3px;
					border-top-right-radius: 3px;
					cursor: pointer;
					font-size: 0.9rem;
					font-family: sans-serif;
					letter-spacing: 0.03rem;
					font-weight: 300;
					transition: color 0.3s ease, font-weight 0.3s ease;
					-moz-appearance: none;
					-webkit-appearance: none;
					appearance: none;
					border: none;
				}
				
				:host .tab-head[aria-selected="true"] {
					font-weight: 500;
					color: #111;
				}
			</style>
		`;
	}
	
	get template() {
		return `<button
			class="tab-head"
			role="tab"
			aria-selected="{active}"
			aria-controls="{contentId}"
			attr.tabindex="-1, !active"
			><slot></slot></button>`
	}
}

class TabContent extends WebComponent {
	static observedAttributes = [
		'active',
		'id',
		'tab-id',
	];
	
	get stylesheet() {
		return `
			<style>
				:host {
					display: inline-block;
				}
				
				:host .tab-content {
					padding: 10px 0;
				}
			</style>
		`;
	}
	
	get template() {
		return `<div
			class="tab-content"
			tabindex="0"
			role="tabpanel"
			id="{id}"
			aria-labelledby="{tabId}"
			attr.hidden="!active"><slot></slot></div>`
	}
}

TabHead.register();
TabContent.register();
TabsContainer.register();

</script>
</body>
</html>
